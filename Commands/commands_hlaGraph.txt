Command to build a Cortex graph of reference without HLA graph:

From /Net/birch/data/dilthey/MHC-PRG/tmp2/GS_nextGen/hla/derived:
(generate reference genome without graph: /Net/birch/data/dilthey/MHC-PRG/src/Util/removeHLAfromReferenceGenome.pl)
 /home/dilthey/Cortex/CORTEX_release_v1.0.5.20/bin/cortex_var_31_c1 --mem_height 26 --mem_width 120 --kmer_size 25 --dump_binary Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx --se_list fileList_Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph &> Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx.output
 

../bin/MHC-PRG domode createConcatenatedVariationGraphs ../tmp2/GS_nextGen/hla --noPGFprotection

../bin/MHC-PRG domode kMerify ../tmp2/GS_nextGen/hla/graph.txt --kmer 31 --noPGFprotection

../bin/MHC-PRG domode kMerify ../tmp2/GS_nextGen/hla/graph.txt --kmer 25 --noPGFprotection

../bin/MHC-PRG domode determineRequiredKMers ../tmp2/GS_nextGen/hla/graph.txt.kmers_31 ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_31 
../bin/MHC-PRG domode determineRequiredKMers ../tmp2/GS_nextGen/hla/graph.txt.kmers_25 ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25

../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_31 --output_FASTQ test.fastQ 

../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ ignore


	../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_31 --output_FASTQ anotherTest.fastQ 

	../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ round4_positive_25_separateOptim.fastQ 

	../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ round5_positive_25_separateOptim.fastQ 
	
	# round 6 has origin information for individual reads
	
	../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ round6_positive_25_separateOptim.fastQ 
	

	
! 	../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ A2_positiveUnique.fastQ  --positiveUnique --uniqueness_base ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --uniqueness_subtract ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx



	Positive filtering
	
		../bin/MHC-PRG domode filterReads --input_FASTQ test.fastQ --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_31 --output_FASTQ test_round2.fastQ
		
		../bin/MHC-PRG domode filterReads --input_FASTQ test_round2.fastQ --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ ignore

		
		
	
	
	Negative filtering:
	
		../bin/MHC-PRG domode filterReads --input_FASTQ test.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph.ctx --output_FASTQ test_round2.fastQ
		
		../bin/MHC-PRG domode filterReads --input_FASTQ anotherTest.fastQ.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph.ctx --output_FASTQ negative_anotherTest.fastQ		

		../bin/MHC-PRG domode filterReads --input_FASTQ round3_positive_25_separateOptim.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx --output_FASTQ round3_positiveANDnegative_25_separateOptim.fastQ

		../bin/MHC-PRG domode filterReads --input_FASTQ round4_positive_25_separateOptim.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx --output_FASTQ round4_positiveANDnegative_25_separateOptim.fastQ
		
		../bin/MHC-PRG domode filterReads --input_FASTQ round5_positive_25_separateOptim.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx --output_FASTQ round5_positiveANDnegative_25_separateOptim.fastQ

		
				
			
		../bin/MHC-PRG domode filterReads --input_FASTQ test_round2.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx --output_FASTQ ignore25.fastQ

		
			../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ round4_positive_25_separateOptim.fastQ 

			
!	../bin/MHC-PRG domode filterReads --input_FASTQ test_positiveUnique.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph.ctx --output_FASTQ test_positiveUnique_negativePreserveUnique.fastQ --negativePreserveUnique --uniqueness_base ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --uniqueness_subtract ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph.ctx_25
		
	And now align:
	
	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ test_round2.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt
	
	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ round3_positiveANDnegative_25_separateOptim.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt

	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ round5_positiveANDnegative_25_separateOptim.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt

		
../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ negative_anotherTest.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt
		
		
		
! 	More aligning ...

	HLA type inference:
	
	../bin/MHC-PRG domode HLATypeInference --input_alignedReads test_round2.fastQ.aligned --graphDir ../tmp2/GS_nextGen/hla
	
	../bin/MHC-PRG domode HLATypeInference --input_alignedReads negative_anotherTest.fastQ.aligned --graphDir ../tmp2/GS_nextGen/hla
	
	
	
	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ round3_positiveANDnegative_25_separateOptim.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt
	
	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ round4_positiveANDnegative_25_separateOptim.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt

	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ round5_positiveANDnegative_25_separateOptim.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt
	
		../bin/MHC-PRG domode HLATypeInference --input_alignedReads round3_positiveANDnegative_25_separateOptim.fastQ.aligned --graphDir ../tmp2/GS_nextGen/hla &> HLAtypes_round3_positiveANDnegative_25_separateOptim.txt

		../bin/MHC-PRG domode HLATypeInference --input_alignedReads round4_positiveANDnegative_25_separateOptim.fastQ.aligned --graphDir ../tmp2/GS_nextGen/hla &> HLAtypes_round4_positiveANDnegative_25_separateOptim.txt
		
		../bin/MHC-PRG domode HLATypeInference --input_alignedReads round5_positiveANDnegative_25_separateOptim.fastQ.aligned --graphDir ../tmp2/GS_nextGen/hla &> HLAtypes_round5_positiveANDnegative_25_separateOptim.txt
		
	
## simulate reads from real HLA haplotypes


	../bin/MHC-PRG domode simulateHLAreads --nIndividuals 10 --graphDir ../tmp2/GS_nextGen/hla --outputDirectory ../tmp/hla/simulations/exon231_error1_perturb0 --readError 1 --perturbHaplotypes 0 --exon23 1

	../bin/MHC-PRG domode simulateHLAreads --nIndividuals 50 --graphDir ../tmp2/GS_nextGen/hla --outputDirectory ../tmp/hla/simulations/exon231_error1_perturb0_indivs50 --readError 1 --perturbHaplotypes 0 --exon23 1
	
	./HLAtypeinference_copySimulations.pl
	
	./HLAtypeinference.pl --sampleIDs allSimulations --actions n 
	
	./HLAtypeinference.pl --sampleIDs allSimulations --actions pa
	
	./HLAtypeinference.pl --sampleIDs allSimulations --actions i
	
	./HLAtypeinference.pl --sampleIDs allSimulations --actions v --trueHLA ../tmp/hla/trueHLA_1_exon231_error1_perturb0	
	
	
	

../bin/MHC-PRG domode describekMerGraph ../tmp2/GS_nextGen/hla/graph.txt.kmers_31 ../tmp2/GS_nextGen/hla/derived/ HLAGRAPH_31 --output_kMer_levels --referenceGenomeCortexGraph ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph.ctx
../bin/MHC-PRG domode describekMerGraph ../tmp2/GS_nextGen/hla/graph.txt.kmers_25 ../tmp2/GS_nextGen/hla/derived/ HLAGRAPH_25 --k 25 --output_kMer_levels --referenceGenomeCortexGraph ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx


## this does not work, for there is no PGF protection

../bin/MHC-PRG domode simulationSuite ../tmp2/GS_nextGen/hla/graph.txt.kmers_31 ../tmp/ SIMU_HLA --genotypingMode 8

## estimate some insert size

dilthey@sequoia:~/picard/picard-tools-1.83$ java -jar CollectInsertSizeMetrics.jar INPUT=/gpfs1/well/gsk_hla/bam_output/AA02O9Q_A1.bam H=HIST_AA02O9Q_A1 O=INSERTSIZE_AA02O9Q_A1

## simulations

../bin/MHC-PRG domode testGraphAligner_realGraph ../tmp2/GS_nextGen/hla/graph.txt



## script

./HLAtypeinference.pl --sampleIDs AA02O9Q_A2 --actions n

./HLAtypeinference.pl --sampleIDs I1_AA02O9Q_A1,I1_AA02O9Q_A2,I1_AA02O9Q_A3,I1_AA02O9Q_A6 --actions a


./HLAtypeinference.pl --sampleIDs AA02O9Q_A2 --actions v --trueHLA /home/dilthey/GSK_NG/GSK_NGclassicalHLA_withG.txt


## negative alignment

./HLAtypeinference.pl --action n --sampleIDs all_I1

# All GSK samples:

./HLAtypeinference.pl --sampleIDs all_I1 --actions a
./HLAtypeinference.pl --sampleIDs all_I1 --actions i
./HLAtypeinference.pl --sampleIDs all_I1 --actions v --trueHLA /home/dilthey/GSK_NG/GSK_NGclassicalHLA_withG.txt


Without combination, T = 0

	Comparisons: 120 -- OK: 103

	PER-LOCUS SUMMARY:
			A: 15 of 20,    Accuracy 0.75   Call rate: 1.00
			B: 16 of 20,    Accuracy 0.80   Call rate: 1.00
			C: 14 of 20,    Accuracy 0.70   Call rate: 1.00
			DQA1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DQB1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DRB1: 18 of 20, Accuracy 0.90   Call rate: 1.00

	T = 0.5
	
	Comparisons: 75 -- OK: 71

	PER-LOCUS SUMMARY:
			A: 5 of 5,      Accuracy 1.00   Call rate: 0.25
			B: 7 of 9,      Accuracy 0.78   Call rate: 0.45
			C: 4 of 4,      Accuracy 1.00   Call rate: 0.20
			DQA1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DQB1: 17 of 17, Accuracy 1.00   Call rate: 0.85
			DRB1: 18 of 20, Accuracy 0.90   Call rate: 1.00

With combination, T = 0

	Comparisons: 120 -- OK: 96

	PER-LOCUS SUMMARY:
			A: 13 of 20,    Accuracy 0.65   Call rate: 1.00
			B: 12 of 20,    Accuracy 0.60   Call rate: 1.00
			C: 13 of 20,    Accuracy 0.65   Call rate: 1.00
			DQA1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DQB1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DRB1: 18 of 20, Accuracy 0.90   Call rate: 1.00
			
	T = 0.5
	
	Comparisons: 73 -- OK: 68

	PER-LOCUS SUMMARY:
			A: 4 of 5,      Accuracy 0.80   Call rate: 0.25
			B: 6 of 9,      Accuracy 0.67   Call rate: 0.45
			C: 4 of 4,      Accuracy 1.00   Call rate: 0.20
			DQA1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DQB1: 18 of 18, Accuracy 1.00   Call rate: 0.90
			DRB1: 16 of 17, Accuracy 0.94   Call rate: 0.85

With mapping quality check, T = 0

	Comparisons: 120 -- OK: 104

	PER-LOCUS SUMMARY:
			A: 16 of 20,    Accuracy 0.80   Call rate: 1.00
			B: 15 of 20,    Accuracy 0.75   Call rate: 1.00
			C: 14 of 20,    Accuracy 0.70   Call rate: 1.00
			DQA1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DQB1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DRB1: 19 of 20, Accuracy 0.95   Call rate: 1.00

	T = 0.5
	
	Comparisons: 64 -- OK: 63

	PER-LOCUS SUMMARY:
			A: 2 of 2,      Accuracy 1.00   Call rate: 0.10
			B: 6 of 6,      Accuracy 1.00   Call rate: 0.30
			C: 3 of 3,      Accuracy 1.00   Call rate: 0.15
			DQA1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DQB1: 15 of 15, Accuracy 1.00   Call rate: 0.75
			DRB1: 17 of 18, Accuracy 0.94   Call rate: 0.90

Just mapping quality check, strandedness and IS:
	
	T = 0
	
	Comparisons: 120 -- OK: 106

	PER-LOCUS SUMMARY:
			A: 14 of 20,    Accuracy 0.70   Call rate: 1.00
			B: 15 of 20,    Accuracy 0.75   Call rate: 1.00
			C: 17 of 20,    Accuracy 0.85   Call rate: 1.00
			DQA1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DQB1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DRB1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			
	T = 0.5
	
	Comparisons: 94 -- OK: 90

	PER-LOCUS SUMMARY:
			A: 9 of 12,     Accuracy 0.75   Call rate: 0.60
			B: 13 of 14,    Accuracy 0.93   Call rate: 0.70
			C: 9 of 9,      Accuracy 1.00   Call rate: 0.45
			DQA1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DQB1: 20 of 20, Accuracy 1.00   Call rate: 1.00
			DRB1: 19 of 19, Accuracy 1.00   Call rate: 0.95


Per-position mapping quality: [0.9]

	Comparisons: 60 -- OK: 55

	PER-LOCUS SUMMARY:
			A: 7 of 10,     Accuracy 0.70   Call rate: 1.00
			B: 9 of 10,     Accuracy 0.90   Call rate: 1.00
			C: 9 of 10,     Accuracy 0.90   Call rate: 1.00
			DQA1: 10 of 10, Accuracy 1.00   Call rate: 1.00
			DQB1: 10 of 10, Accuracy 1.00   Call rate: 1.00
			DRB1: 10 of 10, Accuracy 1.00   Call rate: 1.00


Per-position mapping quality: [0.7]

Comparisons: 60 -- OK: 56

PER-LOCUS SUMMARY:
        A: 8 of 10,     Accuracy 0.80   Call rate: 1.00
        B: 9 of 10,     Accuracy 0.90   Call rate: 1.00
        C: 9 of 10,     Accuracy 0.90   Call rate: 1.00
        DQA1: 10 of 10, Accuracy 1.00   Call rate: 1.00
        DQB1: 10 of 10, Accuracy 1.00   Call rate: 1.00
        DRB1: 10 of 10, Accuracy 1.00   Call rate: 1.00

			